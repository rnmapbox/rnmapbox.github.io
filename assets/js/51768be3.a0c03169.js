"use strict";(self.webpackChunkmap_docs=self.webpackChunkmap_docs||[]).push([[2520],{4613:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>m});var a=t(5893),r=t(1151);const i={title:"Query Terrain Elevation",tags:["MapView#queryTerrainElevation","AnimatedShape","AnimatedRouteCoordinatesArray","AnimatedExtractCoordinateFromArray"],custom_props:{example_rel_path:"V10/QueryTerrainElevation.js"},custom_edit_url:"https://github.com/rnmapbox/maps/tree/master/example/src/examples/V10/QueryTerrainElevation.js"},o=void 0,s={id:"examples/V10/QueryTerrainElevation",title:"Query Terrain Elevation",description:"This is a fairly complex example demonstrating the use of AnimatedShape, Camera animation, queryTerrainElevation and AnimatedMarkerView",source:"@site/docs/examples/V10/QueryTerrainElevation.md",sourceDirName:"examples/V10",slug:"/examples/V10/QueryTerrainElevation",permalink:"/docs/examples/V10/QueryTerrainElevation",draft:!1,unlisted:!1,editUrl:"https://github.com/rnmapbox/maps/tree/master/example/src/examples/V10/QueryTerrainElevation.js",tags:[{inline:!0,label:"MapView#queryTerrainElevation",permalink:"/docs/tags/map-view-query-terrain-elevation"},{inline:!0,label:"AnimatedShape",permalink:"/docs/tags/animated-shape"},{inline:!0,label:"AnimatedRouteCoordinatesArray",permalink:"/docs/tags/animated-route-coordinates-array"},{inline:!0,label:"AnimatedExtractCoordinateFromArray",permalink:"/docs/tags/animated-extract-coordinate-from-array"}],version:"current",frontMatter:{title:"Query Terrain Elevation",tags:["MapView#queryTerrainElevation","AnimatedShape","AnimatedRouteCoordinatesArray","AnimatedExtractCoordinateFromArray"],custom_props:{example_rel_path:"V10/QueryTerrainElevation.js"},custom_edit_url:"https://github.com/rnmapbox/maps/tree/master/example/src/examples/V10/QueryTerrainElevation.js"},sidebar:"examplesSidebar",previous:{title:"Markers",permalink:"/docs/examples/V10/Markers"},next:{title:"Simple Model Layer",permalink:"/docs/examples/V10/SimpleModelLayer"}},l={},m=[];function d(e){const n={code:"code",img:"img",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"This is a fairly complex example demonstrating the use of AnimatedShape, Camera animation, queryTerrainElevation and AnimatedMarkerView"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-jsx",children:"import React, { useState, useEffect, useRef } from 'react';\nimport { Easing, Button, View, Text } from 'react-native';\nimport length from '@turf/length';\nimport { lineString } from '@turf/helpers';\nimport { Animated as RNAnimated } from 'react-native';\nimport {\n  MapView,\n  SkyLayer,\n  Camera,\n  Logger,\n  Terrain,\n  RasterDemSource,\n  Animated,\n  AnimatedShape,\n  AnimatedRouteCoordinatesArray,\n  AnimatedExtractCoordinateFromArray,\n  MarkerView,\n  Atmosphere,\n} from '@rnmapbox/maps';\n\nLogger.setLogLevel('verbose');\n\nconst AnimatedMarkerView = RNAnimated.createAnimatedComponent(MarkerView);\n\nconst styles = {\n  mapView: { flex: 1 },\n  triangleStyle: (size, color) => ({\n    width: 0,\n    height: 0,\n    backgroundColor: 'transparent',\n    // @ts-ignore - borderStyle type issue\n    borderStyle: 'solid',\n    borderLeftWidth: size,\n    borderRightWidth: size,\n    borderTopWidth: size * 1.3,\n    borderLeftColor: 'transparent',\n    borderRightColor: 'transparent',\n    borderTopColor: color,\n  }),\n};\n\nconst QueryTerrainElevation = () => {\n  let [animatedRoute, setAnimatedRoute] = useState(null);\n  let [actPoint, setActPoint] = useState(null);\n  let camera = useRef();\n  let [altitude, setAltitude] = useState(null);\n  let updateAltitudeInterval = useRef();\n  let map = useRef();\n  useEffect(() => {\n    return () => {\n      clearInterval(updateAltitudeInterval.current);\n      updateAltitudeInterval.current = null;\n    };\n  }, []);\n\n  function startAnimation(routeToAnimate) {\n    const ts = lineString(routeToAnimate.__getValue());\n    const total = length(ts, { units: 'meters' });\n    const points = routeToAnimate.__getValue();\n    const endPoint = points[points.length - 1];\n\n    routeToAnimate\n      .timing({\n        toValue: { end: { point: endPoint, from: total } },\n        duration: 20000,\n        easing: Easing.linear,\n      })\n      .start(() => {\n        clearInterval(updateAltitudeInterval.current);\n        updateAltitudeInterval.current = null;\n      });\n\n    camera.current.setCamera({\n      heading: 60,\n      zoomLevel: 13.5,\n      animationDuration: 20000,\n    });\n\n    updateAltitudeInterval.current = setInterval(async () => {\n      setAltitude(\n        Math.floor(\n          await map.current.queryTerrainElevation(actPoint.__getValue()),\n        ),\n      );\n    }, 2000);\n  }\n\n  useEffect(() => {\n    (async () => {\n      let response = await fetch(\n        'https://docs.mapbox.com/mapbox-gl-js/assets/route-pin.geojson',\n      );\n      let featureCollection = await response.json();\n\n      let pinRoute = featureCollection.features[0].geometry.coordinates;\n\n      let animatedPinRoute = new AnimatedRouteCoordinatesArray(pinRoute, {\n        end: {\n          from: length(lineString(pinRoute)),\n        },\n      });\n      setAnimatedRoute(animatedPinRoute);\n      setActPoint(new AnimatedExtractCoordinateFromArray(animatedPinRoute, -1));\n    })();\n  }, []);\n  return (\n    <>\n      <Button title=\"Start\" onPress={() => startAnimation(animatedRoute)} />\n      <MapView\n        style={styles.mapView}\n        styleURL={'mapbox://styles/mapbox/satellite-streets-v11'}\n        ref={map}\n      >\n        <Camera\n          centerCoordinate={[6.58968, 45.39701]}\n          zoomLevel={12.3}\n          heading={162}\n          pitch={76}\n          ref={camera}\n        />\n\n        <RasterDemSource\n          id=\"mapbox-dem\"\n          url=\"mapbox://mapbox.terrain-rgb\"\n          tileSize={512}\n          maxZoomLevel={14}\n        >\n          <SkyLayer\n            id=\"sky-layer\"\n            style={{\n              skyType: 'atmosphere',\n              skyAtmosphereColor: 'rgba(85, 151, 210, 0.5)',\n            }}\n          />\n\n          <Terrain style={{ exaggeration: 1.5 }} />\n          <Atmosphere\n            style={{\n              starIntensity: 1.0,\n              range: [-0.7, 2.0],\n              spaceColor: '#def',\n              color: '#def',\n              highColor: '#def',\n            }}\n          />\n        </RasterDemSource>\n\n        {animatedRoute && (\n          <Animated.ShapeSource\n            id=\"animated-route\"\n            shape={\n              new AnimatedShape({\n                type: 'LineString',\n                coordinates: animatedRoute,\n              })\n            }\n          >\n            <Animated.LineLayer\n              id={'animated-route'}\n              style={{\n                lineColor: 'rgba(255,0,0,255)',\n                lineWidth: 3,\n                lineCap: 'round',\n                lineJoin: 'round',\n              }}\n            />\n          </Animated.ShapeSource>\n        )}\n\n        {actPoint && (\n          <Animated.ShapeSource\n            id=\"currentLocationSource\"\n            shape={\n              new AnimatedShape({\n                type: 'Point',\n                coordinates: actPoint,\n              })\n            }\n          >\n            <Animated.CircleLayer\n              id=\"currentLocationCircle\"\n              style={{\n                circleOpacity: 1.0,\n                circleColor: '#c62221',\n                circleRadius: 6,\n              }}\n            />\n          </Animated.ShapeSource>\n        )}\n        {actPoint && altitude && (\n          <AnimatedMarkerView coordinate={actPoint} anchor={{ x: 0.5, y: 1 }}>\n            <View style={{ alignItems: 'center' }}>\n              <View\n                style={{\n                  backgroundColor: 'white',\n                  padding: 10,\n                  width: 140,\n                  height: 50,\n                  borderRadius: 10,\n                }}\n              >\n                <Text>Altitude: {altitude} m</Text>\n              </View>\n              <View\n                // @ts-ignore - borderStyle type issue in dynamic styles\n                style={[styles.triangleStyle(12, 'white'), { marginTop: -1 }]}\n              />\n            </View>\n          </AnimatedMarkerView>\n        )}\n      </MapView>\n    </>\n  );\n};\n\nexport default QueryTerrainElevation;\n\n\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.img,{alt:"QueryTerrainElevation.png",src:t(3588).Z+"",width:"295",height:"640"}),"}"]})]})}function u(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},3588:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/QueryTerrainElevation-5a1dde7267eb492b0e7258c5da948195.png"},1151:(e,n,t)=>{t.d(n,{Z:()=>s,a:()=>o});var a=t(7294);const r={},i=a.createContext(r);function o(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);